<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Days Since Last Happened</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1 {
      text-align: center;
    }
    #controls {
      text-align: center;
      margin-bottom: 20px;
    }
    #eventGrid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    .event-box {
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 15px;
      text-align: center;
      background-color: #f9f9f9;
      position: relative;
    }
    .event-title {
      font-weight: bold;
      margin-bottom: 10px;
    }
    .event-days {
      font-size: 1.2em;
      margin-bottom: 10px;
    }
    .btn {
      cursor: pointer;
      border: none;
      border-radius: 4px;
      padding: 8px 12px;
      margin: 0 5px;
    }
    .btn-refresh {
      background-color: #28a745;
      color: #fff;
    }
    .btn-delete {
      background-color: #dc3545;
      color: #fff;
    }
    .add-form {
      display: inline-block;
    }
    .add-form input[type="text"] {
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .add-form button {
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 8px 12px;
      margin-left: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Days Since These Events Last Happened</h1>

  <!-- Controls for adding a new event -->
  <div id="controls">
    <form class="add-form" onsubmit="addEvent(event)">
      <input type="text" id="newEventName" placeholder="Event name" required />
      <button type="submit">Add Event</button>
    </form>
  </div>

  <!-- Grid container for events -->
  <div id="eventGrid"></div>

  <script>
    // Local Storage Key
    const STORAGE_KEY = 'daysSinceEvents';

    // Load events from localStorage or create an empty array if none exist
    let events = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

    // Helper function: Calculate difference in days between now and a given date
    function daysSince(dateString) {
      const now = new Date();
      const past = new Date(dateString);
      const diffInMs = now - past;
      // Convert milliseconds to days (rounded down)
      return Math.floor(diffInMs / (1000 * 60 * 60 * 24));
    }

    // Render all events in the grid
    function renderEvents() {
      const eventGrid = document.getElementById('eventGrid');
      eventGrid.innerHTML = ''; // Clear existing items

      events.forEach((ev, index) => {
        // Calculate how many days since the event was last refreshed
        const dayCount = daysSince(ev.lastUpdated);

        // Create the event box
        const box = document.createElement('div');
        box.className = 'event-box';

        const title = document.createElement('div');
        title.className = 'event-title';
        title.textContent = ev.name;

        const dayDisplay = document.createElement('div');
        dayDisplay.className = 'event-days';
        dayDisplay.textContent = `${dayCount} day${dayCount !== 1 ? 's' : ''} since last happened`;

        // Refresh button
        const refreshBtn = document.createElement('button');
        refreshBtn.className = 'btn btn-refresh';
        refreshBtn.textContent = 'Refresh';
        refreshBtn.addEventListener('click', () => refreshEvent(index));

        // Delete button
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'btn btn-delete';
        deleteBtn.textContent = 'Delete';
        deleteBtn.addEventListener('click', () => deleteEvent(index));

        // Append elements to the box
        box.appendChild(title);
        box.appendChild(dayDisplay);
        box.appendChild(refreshBtn);
        box.appendChild(deleteBtn);

        // Add to the grid
        eventGrid.appendChild(box);
      });
    }

    // Save events array to localStorage
    function saveEvents() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
    }

    // Add a new event (sets its 'lastUpdated' to now)
    function addEvent(e) {
      e.preventDefault(); // Prevent page refresh
      const input = document.getElementById('newEventName');
      const eventName = input.value.trim();
      if (!eventName) return;

      events.push({
        name: eventName,
        lastUpdated: new Date().toISOString()
      });
      saveEvents();
      renderEvents();
      input.value = ''; // Clear the input
    }

    // Refresh an event (set 'lastUpdated' to now)
    function refreshEvent(index) {
      events[index].lastUpdated = new Date().toISOString();
      saveEvents();
      renderEvents();
    }

    // Delete an event
    function deleteEvent(index) {
      events.splice(index, 1);
      saveEvents();
      renderEvents();
    }

    // Initial render on page load
    renderEvents();
  </script>
</body>
</html>
